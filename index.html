<!doctype html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <title>Proyecto Mazocruz - Sistema de Visualización Geológica</title>
        
        <!-- OpenLayers -->
        <link rel="stylesheet" href="./resources/ol.css">
        
        <!-- Font Awesome -->
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        
        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        
        <!-- OpenLayers Layer Switcher -->
        <link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
        <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
        
        <!-- qgis2web styles -->
        <link rel="stylesheet" href="./resources/qgis2web.css">
        
        <!-- Custom styles -->
        <link rel="stylesheet" href="css/style.css">
        
        <style>
        html, body {
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        .ol-control > * {
            background-color: #f8f8f8!important;
            color: #444444!important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444!important;
        }
        .search-layer-input-search {
            background-color: #f8f8f8!important;
        }
        .ol-control > *:focus, .ol-control >*:hover {
            background-color: rgba(248, 248, 248, 0.7)!important;
        } 
        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
        }
        </style>
    </head>
    <body>
        <!-- Loading -->
        <div id="loading" class="loading-overlay">
            <div class="spinner-container">
                <div class="spinner-border text-primary" role="status"></div>
                <p>Cargando sistema geológico...</p>
            </div>
        </div>

        <!-- Barra de Navegación -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-mountain"></i>
                    Proyecto Mazocruz
                </a>
                
                <div class="navbar-nav ms-auto">
                    <span class="navbar-text me-3" id="user-info">
                        <i class="fas fa-user"></i>
                        <span id="username-display">Invitado</span>
                        (<span id="user-role">No autenticado</span>)
                    </span>
                    <div class="btn-group">
                        <button class="btn btn-outline-light btn-sm" id="btn-profile">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="btn btn-outline-danger btn-sm" id="btn-logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Contenedor Principal -->
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-3 col-lg-2 sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <button class="btn btn-sm btn-outline-secondary" id="toggle-sidebar">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>

                    <!-- Panel de Capas -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6><i class="fas fa-layer-group"></i> Capas del Mapa</h6>
                        </div>
                        <div class="card-body" id="layer-controls">
                            <!-- Las capas se cargan dinámicamente -->
                            <p class="text-muted small">Cargando capas...</p>
                        </div>
                    </div>

                    <!-- Panel de Herramientas -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6><i class="fas fa-tools"></i> Herramientas</h6>
                        </div>
                        <div class="card-body">
                            <div class="btn-group-vertical w-100" id="tool-buttons">
                                <!-- Herramientas básicas para todos -->
                                <button class="btn btn-outline-primary btn-sm mb-2 tool-btn" data-tool="info">
                                    <i class="fas fa-info-circle"></i> Información
                                </button>
                                <button class="btn btn-outline-primary btn-sm mb-2 tool-btn" data-tool="measure">
                                    <i class="fas fa-ruler"></i> Medir
                                </button>
                                
                                <!-- Herramientas para editores y admin -->
                                <button class="btn btn-outline-warning btn-sm mb-2 tool-btn editor-only" data-tool="draw-point" style="display: none;">
                                    <i class="fas fa-draw-polygon"></i> Dibujar Punto
                                </button>
                                <button class="btn btn-outline-warning btn-sm mb-2 tool-btn editor-only" data-tool="draw-line" style="display: none;">
                                    <i class="fas fa-draw-polygon"></i> Dibujar Línea
                                </button>
                                <button class="btn btn-outline-warning btn-sm mb-2 tool-btn editor-only" data-tool="draw-polygon" style="display: none;">
                                    <i class="fas fa-draw-polygon"></i> Dibujar Polígono
                                </button>
                                
                                <!-- Herramientas solo para admin -->
                                <button class="btn btn-outline-danger btn-sm mb-2 tool-btn admin-only" data-tool="manage-users" style="display: none;">
                                    <i class="fas fa-users-cog"></i> Gestionar Usuarios
                                </button>
                                <button class="btn btn-outline-danger btn-sm mb-2 tool-btn admin-only" data-tool="import-data" style="display: none;">
                                    <i class="fas fa-file-import"></i> Importar Datos
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Panel de Información -->
                    <div class="card">
                        <div class="card-header">
                            <h6><i class="fas fa-info-circle"></i> Información</h6>
                        </div>
                        <div class="card-body">
                            <div id="feature-info">
                                <p class="text-muted small">Seleccione un elemento en el mapa</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mapa -->
                <div class="col-md-9 col-lg-10 main-content">
                    <div id="map" class="map">
                        <div id="popup" class="ol-popup">
                            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                            <div id="popup-content"></div>
                        </div>
                    </div>
                    
                    <!-- Controles del Mapa -->
                    <div class="map-controls">
                        <div class="btn-group-vertical">
                            <button class="btn btn-light btn-sm" id="zoom-in" title="Zoom In">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn btn-light btn-sm" id="zoom-out" title="Zoom Out">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button class="btn btn-light btn-sm" id="reset-view" title="Vista Inicial">
                                <i class="fas fa-home"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Gestión de Usuarios (Solo Admin) -->
        <div class="modal fade" id="userManagementModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Gestión de Usuarios</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="user-management-content">
                            <!-- Contenido cargado dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts de qgis2web (deben cargarse antes de nuestros scripts) -->
        <script src="resources/qgis2web_expressions.js"></script>
        <script src="./resources/functions.js"></script>
        <script src="./resources/ol.js"></script>
        <script src="./resources/ol-layerswitcher.js"></script>
        <script src="resources/photon-geocoder-autocomplete.min.js"></script>
        <script src="layers/ConcesionesSantaRosa_Mazocruz_1.js"></script>
        <script src="layers/Volcanes_2.js"></script>
        <script src="layers/Geoqumica_franja1_3.js"></script>
        <script src="layers/Accesos_principales_4.js"></script>
        <script src="styles/ConcesionesSantaRosa_Mazocruz_1_style.js"></script>
        <script src="styles/Volcanes_2_style.js"></script>
        <script src="styles/Geoqumica_franja1_3_style.js"></script>
        <script src="styles/Accesos_principales_4_style.js"></script>
        <script src="./layers/layers.js" type="text/javascript"></script> 
        <script src="./resources/Autolinker.min.js"></script>
        
        <!-- Bootstrap -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Scripts de autenticación y gestión (deben cargarse después de qgis2web) -->
        <script src="js/auth.js"></script>
        <script src="js/data-persistence.js"></script>
        <script src="js/user-manager.js"></script>
        <script src="js/layer-manager.js"></script>
        <script src="js/map-manager.js"></script>
        
        <!-- Script de qgis2web (debe cargarse después de nuestros scripts de gestión) -->
        <script src="./resources/qgis2web.js"></script>
        
        <!-- Aplicación principal (debe cargarse al final) -->
        <script src="js/app.js"></script>
    </body>
</html>
